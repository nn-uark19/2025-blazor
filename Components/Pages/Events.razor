@page "/Events"
<h3>Events</h3>

@inject NavigationManager NavigationManager

@* Search box: allows users to type and filter events by name dynamically *@
<div>
    <input @bind-value="SearchText" @bind-value:event="oninput" placeholder="Search events by name" />
</div>

@* Month buttons: renders a button for each month group *@
<MonthListComponent
    MonthGroups="_monthGroups"
    SelectedMonthGroup="_selectedMonthGroup"
    SelectMonthGroupCallBack="OnMonthSelected" />

@* Selected month display: show image and name for the active group *@
@if (_selectedMonthGroup != null)
{
    <div>
        <img src="@_selectedMonthGroup.ImagePath"
             alt="@_selectedMonthGroup.Key"
             width="300" height="300" />
        <h3>@_selectedMonthGroup.Name</h3>
    </div>
}

@* Add Event button: navigates to the Add Event page *@
<button type="button" @onclick="AddEvent">Add Event</button>

@* Event list: lists events for the selected month group *@
<EventListComponent EventList="_eventList" />

@code {
    private List<EventDto> _eventList = new();
    private List<MonthGroup> _monthGroups = new();
    private MonthGroup? _selectedMonthGroup;
    private string _searchText = string.Empty;
    private string SearchText
    {
        get => _searchText;
        set
        {
            _searchText = value;
            _eventList = EventRepository.SearchByName(_searchText);
        }
    }

    protected override void OnInitialized()
    {
        _monthGroups = MonthRepository.GetMonthGroups();
        _selectedMonthGroup = _monthGroups.FirstOrDefault();

        if (_selectedMonthGroup != null)
        {
            var months = _selectedMonthGroup.Months;
            _eventList = EventRepository.GetAll()
                .Where(e => months.Contains(e.Month))
                .ToList();
        }
    }
    
    // Called when CityListComponent notifies parent of a month-group selection
    private void OnMonthSelected(MonthGroup? group)
    {
        _selectedMonthGroup = group;

        if (_selectedMonthGroup != null)
        {
            var months = _selectedMonthGroup.Months;
            _eventList = EventRepository.GetAll()
                .Where(e => months.Contains(e.Month))
                .ToList();
        }
    }
    
    // Triggered when the user clicks the Add Event button; navigates to the add-event page
    private void AddEvent()
    {
        NavigationManager.NavigateTo("/events/add");
    }
}