@* Renders a single event as a Bootstrap-styled list-group item *@
@inject NavigationManager NavigationManager

<li @key="Event?.EventId" class="list-group-item d-flex justify-content-between align-items-start">
    <div class="ms-2 me-auto">
        <div class="fw-bold">@Event?.Name</div>
        <div class="text-muted small">Month: @Event?.Month â€” @(Event?.IsFree == true ? "Free" : "Paid")</div>
    </div>

    <div class="btn-group btn-group-sm" role="group" aria-label="Event actions">
        <button class="btn btn-outline-primary" @onclick="() => EditEvent(Event!.EventId)">Edit</button>

        @if (!_confirming)
        {
            <button class="btn btn-outline-danger" @onclick="() => _confirming = true">Delete</button>
        }
        else
        {
            <button class="btn btn-danger" @onclick="ConfirmDelete">Yes</button>
            <button class="btn btn-secondary" @onclick="() => _confirming = false">No</button>
        }
    </div>
</li>

@code {
    [Parameter] public EventDto? Event { get; set; }

    private bool _confirming;

    // Triggered when the user clicks an event's Edit button; navigates to the edit page for that event id
    private void EditEvent(int id)
    {
        NavigationManager.NavigateTo($"/events/edit/{id}");
    }

    private void ConfirmDelete()
    {
        _confirming = false;
        if (Event is null) return;

        // Child performs the delete directly in the repository (synchronous in this project)
        EventRepository.Delete(Event.EventId);

        // Force a full page reload to reflect repository changes immediately
        NavigationManager.NavigateTo(NavigationManager.Uri, forceLoad: true);
    }
}
