@inject NavigationManager NavigationManager

@* Month buttons: renders a button for each month group *@
<div>
    @foreach (var mg in _monthGroups)
    {
        <button type="button" @onclick="() => SelectGroup(mg)">
            @mg.Name@(_selectedMonthGroup == mg ? " (selected)" : "")
        </button>
    }
</div>

@* Selected month display: show image and name for the active group *@
@if (_selectedMonthGroup != null)
{
    <div>
        <img src="@_selectedMonthGroup.ImagePath"
             alt="@_selectedMonthGroup.Key"
             width="300" height="300" />
        <h3>@_selectedMonthGroup.Name</h3>
    </div>
}

@* Add Event button: navigates to the Add Event page *@
<button type="button" @onclick="AddEvent">Add Event</button>

@* Event list: lists events for the selected month group *@
@if (_eventList.Count > 0)
{
    <ul>
        @foreach (var e in _eventList)
        {
            <li>
                <strong>@e.Name</strong>
                Month: @e.Month â€” @(e.IsFree ? "Free" : "Paid")
                <button @onclick="() => EditEvent(e.EventId)">Edit</button>
            </li>
        }
    </ul>
}

@code {
    private List<EventDto> _eventList = new();
    private List<MonthGroup> _monthGroups = new();
    private MonthGroup? _selectedMonthGroup;

    protected override void OnInitialized()
    {
        _monthGroups = MonthRepository.GetMonthGroups();
        _selectedMonthGroup = _monthGroups.FirstOrDefault();

        if (_selectedMonthGroup != null)
        {
            var months = _selectedMonthGroup.Months;
            _eventList = EventRepository.GetAll()
                .Where(e => months.Contains(e.Month))
                .ToList();
        }
    }

    private void SelectGroup(MonthGroup group)
    {
        _selectedMonthGroup = group;
        var months = group.Months;
        _eventList = EventRepository.GetAll()
            .Where(e => months.Contains(e.Month))
            .ToList();
    }

    private void EditEvent(int id)
    {
        NavigationManager.NavigateTo($"/events/edit/{id}");
    }
    
    private void AddEvent()
    {
        NavigationManager.NavigateTo("/events/add");
    }
}