@* Event list: lists events for the selected month group (standalone or parent-driven) *@
@inject NavigationManager NavigationManager

@if (_eventsToRender.Count > 0)
{
    <ul>
        @foreach (var e in _eventsToRender)
        {
            <li>
                <strong>@e.Name</strong>
                Month: @e.Month â€” @(e.IsFree ? "Free" : "Paid")
                <button @onclick="() => OnEditInternal(e.EventId)">Edit</button>
            </li>
        }
    </ul>
}
else
{
    <p>No events found.</p>
}

@code {
    // Optional: provide a pre-filtered list
    [Parameter] public List<EventDto>? EventList { get; set; }

    // Optional: parent can handle edit; otherwise the component will navigate to the edit page itself.
    [Parameter] public EventCallback<int> OnEdit { get; set; }

    // Optional: parent can tell the component which month group is selected so the component can filter by months
    [Parameter] public MonthGroup? SelectedMonthGroup { get; set; }

    // Optional: parent can provide a search text for name filtering (case-insensitive)
    [Parameter] public string? SearchText { get; set; }

    private List<EventDto> _eventsToRender = new();

    protected override void OnParametersSet()
    {
        // start with provided list or repository
        IEnumerable<EventDto> events = EventList ?? EventRepository.GetAll();

        // filter by selected month group if provided
        if (SelectedMonthGroup != null)
        {
            var months = SelectedMonthGroup.Months;
            events = events.Where(e => months.Contains(e.Month));
        }

        // filter by search text if provided
        if (!string.IsNullOrWhiteSpace(SearchText))
        {
            var q = SearchText.Trim();
            events = events.Where(e => !string.IsNullOrWhiteSpace(e.Name) && e.Name.Contains(q, StringComparison.OrdinalIgnoreCase));
        }

        _eventsToRender = events.ToList();
    }

    private void OnEditInternal(int id)
    {
        if (OnEdit.HasDelegate)
        {
            OnEdit.InvokeAsync(id);
            return;
        }

        NavigationManager.NavigateTo($"/events/edit/{id}");
    }
}
